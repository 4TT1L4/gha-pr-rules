name: Protect Git Branch

on:
  pull_request_target:
    branches: [ "protected" ]

jobs:
  check-pr-source:
    if:  github.event.pull_request.base.ref == 'protected'
    runs-on: ubuntu-latest
    steps:
      - name: Dump GitHub context
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
        run: echo "$GITHUB_CONTEXT"
      - name: Dump job context
        env:
          JOB_CONTEXT: ${{ toJson(job) }}
        run: echo "$JOB_CONTEXT"
      - name: Dump steps context
        env:
          STEPS_CONTEXT: ${{ toJson(steps) }}
        run: echo "$STEPS_CONTEXT"
      - name: Dump runner context
        env:
          RUNNER_CONTEXT: ${{ toJson(runner) }}
        run: echo "$RUNNER_CONTEXT"
      - name: Dump strategy context
        env:
          STRATEGY_CONTEXT: ${{ toJson(strategy) }}
        run: echo "$STRATEGY_CONTEXT"
      - name: Dump matrix context
        env:
          MATRIX_CONTEXT: ${{ toJson(matrix) }}
        run: echo "$MATRIX_CONTEXT"
      - name: "Source branch: ${{ github.head_ref }}"
        run: |
          echo "PR Source branch: ${{ github.head_ref }}"
      - name: "Target branch: ${{ github.event.pull_request.base.ref }}"
        run: |
          echo "PR Target branch: ${{ github.event.pull_request.base.ref }}"
      - name: "ACCEPTED!"
        if: ${{ github.head_ref == 'main' }}
        run: |
          echo "Accepted. Source branch is main."
          exit 0
      - name: "REJECTED!"
        if: ${{ github.head_ref != 'main' }}
        run: |
          echo "Rejected. Source branch must be main"
          exit 1
